# **************************************************************************** #
#                                                                              #
#                                                         :::      ::::::::    #
#    Makefile                                           :+:      :+:    :+:    #
#                                                     +:+ +:+         +:+      #
#    By: wricky-t <wricky-t@student.42.fr>          +#+  +:+       +#+         #
#                                                 +#+#+#+#+#+   +#+            #
#    Created: 2023/02/10 13:51:54 by wricky-t          #+#    #+#              #
#    Updated: 2023/02/22 10:56:11 by wricky-t         ###   ########.fr        #
#                                                                              #
# **************************************************************************** #

#------------------------------------------------------------------------------#
#   INGREDIENTS                                                                #
#------------------------------------------------------------------------------#

NAME		:= philo

CC			:= gcc -g3

CFLAGS		:= -Wall -Werror -Wextra -pthread

ifeq ($(DB), 1)
	CFLAGS += -fsanitize=thread
	# CFLAGS += -fsanitize=address
endif

SRC_PATH	:= .

OBJ_PATH	:= objs

INCLUDES	:= $(SRC_PATH)/*.h

INCFLAGS	:= -I $(INCLUDES)

RM			:= rm -rf

NORM		:= norminette

INSTR		:= "./philo ðŸ‘¥ ðŸ’€ ðŸ˜‹ ðŸ˜´ [ðŸ”¢]"

#------------------------------------------------------------------------------#
#   PROGRAM'S SCRS                                                             #
#------------------------------------------------------------------------------#

SRCS		:= $(wildcard $(SRC_PATH)/*.c)

OBJS		:= $(SRCS:$(SRC_PATH)/%.c=$(OBJ_PATH)/%.o)

#------------------------------------------------------------------------------#
#   STYLING                                                                    #
#------------------------------------------------------------------------------#

GR			:= \033[1;92m

BL			:= \033[1;34m

WH			:= \033[1;37m

UWH			:= \033[4;37m

YL			:= \033[1;33m

DF			:= \033[0m

#------------------------------------------------------------------------------#
#   RECIPE                                                                     #
#------------------------------------------------------------------------------#

all: $(NAME)
	@clear
	@echo ""
	@echo "                       $(GR)â£¿â£¿"
	@echo "                      â£ â£¿â£¿â£„"
	@echo "                     â¢°â£¿â£¿â£¿â£¿â¡†"
	@echo "                     â ˜â¢»â£¿â£¿â¡Ÿâ ƒ$(DF)"
	@echo "          $(GR) â¢€â£¶â£¶â¡€$(DF)    â¢€â£€â£€â£ˆâ£‰â£‰â£â£€â£€â¡€     $(GR)â£°â£¶â£†"
	@echo "            â£¿â£¿ $(DF) â¢ â£¶â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¶â¡„ $(GR) â¢°â£¿â¡†"
	@echo "          â¢ â£¿â£¿â£¿â£·$(DF)  â ‰â ›â ¿â ¿â£¿â£¿â£¿â£¿â£¿â£¿â ¿â ¿â ›â ‰  $(GR)â£¼â£¿â£¿â£¿â£§"
	@echo "          â ¸â¢¿â£¿â£¿â ¿$(DF)   â£·    $(GR)â£ â£„$(DF)    â£¾   $(GR)â ¿â£¿â£¿â£¿â ¿"
	@echo "            â£¿â£¿$(DF)    â ‰    $(GR)â£¿â£¿$(DF)    â ‰    $(GR)â£¿â£¿â£¿"
	@echo "            â »â Ÿ$(DF)        $(GR)â£¾â£¿â£¿â£· $(DF)       $(GR)â ˜â ¿â ƒ"
	@echo "                     $(GR)â¢¸â£¿â£¿â£¿â£¿â¡‡$(DF)"
	@echo "                     $(GR)â ˆâ¢¹â£¿â£¿â¡â $(DF)"
	@echo "                       $(GR)â£¿â£¿$(DF)"
	@echo ""
	@echo "$(WH)Welcome philosophers! How many will be dining today?"
	@echo ""
	@echo "       	      $(INSTR)$(DF)"
	@echo ""

ifeq ($(DB), 1)
	@echo ""
	@echo "               ðŸ› DEBUG MODE ðŸ›"
	@echo ""
endif

help:
	@clear
	@echo "$(WH)$(INSTR)"
	@echo ""
	@echo "ARGUMENTS:"
	@echo ""
	@echo "  ðŸ‘¥: Number of philo      (1 - 200)"
	@echo "  ðŸ’€: Time to die          (in ms)"
	@echo "  ðŸ˜‹: Time to eat          (in ms)"
	@echo "  ðŸ˜´: Time to sleep        (in ms)"
	@echo "  ðŸ”¢: Number of simulation (> 0)     $(YL)[OPTIONAL]"
	@echo ""
	@echo "Note: Positive numeric argument only!"
	@echo ""
	@echo "$(WH)To check if there's a $(GR)data race$(WH), compile with DB=1"
	@echo "$(DF)"

$(NAME): $(OBJS)
	@echo "$(YL)ðŸ§™ Preparing table for the philosophers...$(DF)"
	@$(CC) $(CFLAGS) $^ -o $@

$(OBJ_PATH)/%.o: $(SRC_PATH)/%.c
	@mkdir -p $(@D)
	@$(CC) $(CFLAGS) -c $< -o $@
	@echo "$(WH)ðŸ³ Cooking $(UWH)$(notdir $<)$(DF)"

clean:
	@clear
	@$(RM) $(OBJ_PATH)
	@echo "$(BL)ðŸ§» Cleaning off the table...$(DF)"

fclean: clean
	@$(RM) $(NAME)
	@$(RM) *.dSYM

re: fclean all

norm: $(SRCS)
	@clear
	@$(NORM) $(SRCS) $(INCLUDES)

val: all
	@valgrind --leak-check=full --show-leak-kinds=definite,possible --log-file=leaks.txt ./philo 4 310 200 200

.PHONY:
	clean fclean re
