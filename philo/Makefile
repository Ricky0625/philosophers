# **************************************************************************** #
#                                                                              #
#                                                         :::      ::::::::    #
#    Makefile                                           :+:      :+:    :+:    #
#                                                     +:+ +:+         +:+      #
#    By: wricky-t <wricky-t@student.42.fr>          +#+  +:+       +#+         #
#                                                 +#+#+#+#+#+   +#+            #
#    Created: 2023/02/10 13:51:54 by wricky-t          #+#    #+#              #
#    Updated: 2023/02/20 17:51:26 by wricky-t         ###   ########.fr        #
#                                                                              #
# **************************************************************************** #

#------------------------------------------------------------------------------#
#   INGREDIENTS                                                                #
#------------------------------------------------------------------------------#

NAME		:= philo

CC			:= gcc -g3

CFLAGS		:= -Wall -Werror -Wextra -pthread

ifeq ($(DB), 1)
	CFLAGS += -fsanitize=thread
	# CFLAGS += -fsanitize=address
endif

SRC_PATH	:= .

OBJ_PATH	:= objs

INCLUDES	:= $(SRC_PATH)/*.h

INCFLAGS	:= -I $(INCLUDES)

RM			:= rm -rf

NORM		:= norminette

INSTR		:= "./philo üë• üíÄ üòã üò¥ [üî¢]"

#------------------------------------------------------------------------------#
#   PROGRAM'S SCRS                                                             #
#------------------------------------------------------------------------------#

SRCS		:= $(wildcard $(SRC_PATH)/*.c)

OBJS		:= $(SRCS:$(SRC_PATH)/%.c=$(OBJ_PATH)/%.o)

#------------------------------------------------------------------------------#
#   STYLING                                                                    #
#------------------------------------------------------------------------------#

GR			:= \033[1;92m

BL			:= \033[1;34m

WH			:= \033[1;37m

UWH			:= \033[4;37m

YL			:= \033[1;33m

DF			:= \033[0m

#------------------------------------------------------------------------------#
#   RECIPE                                                                     #
#------------------------------------------------------------------------------#

all: $(NAME)
	@clear
	@echo ""
	@echo "                       $(GR)‚£ø‚£ø"
	@echo "                      ‚£†‚£ø‚£ø‚£Ñ"
	@echo "                     ‚¢∞‚£ø‚£ø‚£ø‚£ø‚°Ü"
	@echo "                     ‚†ò‚¢ª‚£ø‚£ø‚°ü‚†É$(DF)"
	@echo "          $(GR) ‚¢Ä‚£∂‚£∂‚°Ä$(DF)    ‚¢Ä‚£Ä‚£Ä‚£à‚£â‚£â‚£Å‚£Ä‚£Ä‚°Ä     $(GR)‚£∞‚£∂‚£Ü"
	@echo "            ‚£ø‚£ø $(DF) ‚¢†‚£∂‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£∂‚°Ñ $(GR) ‚¢∞‚£ø‚°Ü"
	@echo "          ‚¢†‚£ø‚£ø‚£ø‚£∑$(DF)  ‚†â‚†õ‚†ø‚†ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚†ø‚†ø‚†õ‚†â  $(GR)‚£º‚£ø‚£ø‚£ø‚£ß"
	@echo "          ‚†∏‚¢ø‚£ø‚£ø‚†ø$(DF)   ‚£∑    $(GR)‚£†‚£Ñ$(DF)    ‚£æ   $(GR)‚†ø‚£ø‚£ø‚£ø‚†ø"
	@echo "            ‚£ø‚£ø$(DF)    ‚†â    $(GR)‚£ø‚£ø$(DF)    ‚†â    $(GR)‚£ø‚£ø‚£ø"
	@echo "            ‚†ª‚†ü$(DF)        $(GR)‚£æ‚£ø‚£ø‚£∑ $(DF)       $(GR)‚†ò‚†ø‚†É"
	@echo "                     $(GR)‚¢∏‚£ø‚£ø‚£ø‚£ø‚°á$(DF)"
	@echo "                     $(GR)‚†à‚¢π‚£ø‚£ø‚°è‚†Å$(DF)"
	@echo "                       $(GR)‚£ø‚£ø$(DF)"
	@echo ""
	@echo "$(WH)Welcome philosophers! How many will be dining today?"
	@echo ""
	@echo "       $(INSTR)$(DF)"
	@echo ""

ifeq ($(DB), 1)
	@echo ""
	@echo "               üêõ DEBUG MODE üêõ"
	@echo ""
endif

help:
	@clear
	@echo "$(WH)$(INSTR)"
	@echo ""
	@echo "ARGUMENTS:"
	@echo ""
	@echo "  üë•: Number of philo      (1 - 200)"
	@echo "  üíÄ: Time to die          (in ms)"
	@echo "  üòã: Time to eat          (in ms)"
	@echo "  üò¥: Time to sleep        (in ms)"
	@echo "  üî¢: Number of simulation $(YL)(OPTIONAL)"
	@echo ""
	@echo "Note: Positive numeric argument only!"
	@echo ""
	@echo "$(WH)To check if there's a $(GR)data race$(WH), compile with DB=1"
	@echo "$(DF)"

$(NAME): $(OBJS)
	@echo "$(YL)üßô Preparing table for the philosophers...$(DF)"
	@$(CC) $(CFLAGS) $^ -o $@

$(OBJ_PATH)/%.o: $(SRC_PATH)/%.c
	@mkdir -p $(@D)
	@$(CC) $(CFLAGS) -c $< -o $@
	@echo "$(WH)üç≥ Cooking $(UWH)$(notdir $<)$(DF)"

clean:
	@clear
	@$(RM) $(OBJ_PATH)
	@echo "$(BL)üßª Cleaning off the table...$(DF)"

fclean: clean
	@$(RM) $(NAME)
	@$(RM) *.dSYM

re: fclean all

norm: $(SRCS)
	@clear
	@$(NORM) $(SRCS) $(INCLUDES)

val: all
	@valgrind --leak-check=full --show-leak-kinds=definite,possible --log-file=leaks.txt ./philo 4 410 200 200

.PHONY:
	clean fclean re
